# vim: set ft=sh:

### Exports

export PS1="\[\e[1;34m[\]\\u@\\h \\W]\\$\[\e[0m\] "

export PATH="$PATH:/bin:/usr/bin:/usr/local/bin:$HOME/code/go/bin/"

export EDITOR="vim"

export GOPATH="$HOME/code/go/"

export LESSOPEN="| /usr/bin/source-highlight-esc.sh %s"
export LESS='-R '

### Aliases

alias du="du -h"
alias df="df -h"

alias ll="ls --color=auto -Fhal"

alias mv="mv -v"
alias cp="cp -v"
alias rm="rm -v"

alias chmod="chmod -v"
alias chown="chown -v"

alias cu="cp -u"

alias gdb="gdb -q"

alias sqlite3="sqlite3 -column -header"

#alias mv="$HOME/.shell/bin/mv"

### Functions

die () {
	echo $2
	exit $1
}

edsh () {
	if [ ! -e $1 ]
	then
		echo "#!/bin/sh" > $1 && chmod u+x $1 && $EDITOR $1
	else
		$EDITOR $1
	fi
}

cl () {
	cd $1 && ls
}

mc () {
	mv ${@#$1} $1 && cd $1
}

mkcd () {
	mkdir $1 && cd $1
}

mergdir () {
	for d in $@
	do
		mv -i ./$d/* ./ && rmdir $d
	done
}

# srename
smv () (
	pat=$1
	rep=$2

	shift 2

	for arg in "$@"
	do
		echo $arg
	done |  sed -n "/$pat/ p" | while read -r src
	do
		dest="$(echo $src | sed "s/$pat/$rep/")"

		mv -i "$src" "$dest"
	done
)

mmv () {
	if [ ! -e $2 ]
	then
		mkdir $2 || return $?
	elif [ ! -d $2 ]
	then
		echo "mmv: target is not a directory: $2"
		return 1
	fi
	find . ! -name . -prune -regex ./"$1" -exec mv {} $2 \;
}

cpe () {
	cp $1 $2 && $EDITOR $2
}

append () {
	cat ->> $1
}

sprunge () {
	# TODO: only add parameters if they're set
	url="$(curl -F 'sprunge=<-' http://sprunge.us | tr -d '\n')"
	echo $url?$1#n-$2
}

bukit () {
	url="$(curl -X POST --data-binary @- http://p.offblast.org/new | tr -d '\n')"
	echo $url
}

# pidof - for systems that don't have it
#pidof () {
#	ps a - | sed -e 's/^ *//' | grep "$1" | cut -d ' ' -f 1
#}

world () {
	printf "Brisbane: %s\n" "$(date)" && 
	printf "London: %s\n" "$(TZ='Europe/London' date)" && 
	echo -n "Los Angeles: " && TZ='America/Los_Angeles' date &&
	echo -n "New York: " && TZ="America/New_York" date
}

onbattery () {
	cpupower frequency-set -g powersave
	echo battery > /sys/class/drm/card0/device/power_dpm_state
}

offbattery () {
	cpupower frequency-set -g performance
	echo performance > /sys/class/drm/card0/device/power_dpm_state
}

man() {
    env LESS_TERMCAP_mb=$'\E[01;31m' \
    LESS_TERMCAP_md=$'\E[01;38;5;74m' \
    LESS_TERMCAP_me=$'\E[0m' \
    LESS_TERMCAP_se=$'\E[0m' \
    LESS_TERMCAP_so=$'\E[38;5;246m' \
    LESS_TERMCAP_ue=$'\E[0m' \
    LESS_TERMCAP_us=$'\E[04;38;5;146m' \
    man "$@"
}

